---
title: "Clust_01"
author: "Ricardo Herena"
date: "8/5/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
setwd("~/Documents/Text Analysis Pred 453/P454_TextCluster")
library("tm")
library("SnowballC")
library("wordcloud")
library("RColorBrewer")
library(cluster)
```


```{r read_data}

c_m = read.csv("dtms.csv", sep=",", row.names=1)
dsi_m <- t(c_m)
d_m <- dist(c_m, method="euclidean")
dsi_m <- dist(dsi_m, method="euclidean")

```

Below are some word clouds. We can use these to understand our matrix from a high level. We can also compute tf-idf for word clouds. 

```{r tf-idf-wordclouds}

#tf-idf totals for plotting
v <- sort(rowSums(c_m),decreasing=TRUE)
d <- data.frame(word = names(v),freq=v)

set.seed(1234)
wordcloud(words = d$word, freq = d$freq, min.freq = 1,
          max.words=200, random.order=FALSE, rot.per=0.35, 
          colors=brewer.pal(8, "Dark2"))


```

Hierarchical Clustering

We can see various clusters emerging from our Hclust. We write this to a PDF. A we can see there are many clusters that stem from the top. Our initial guess is something like 10-20 clusters, but very messy ones for the word concepts, and around 6 DSI clusters as identified by prior cohorts.

```{r hclust1}

hcl <- hclust(d_m)
plot(hcl)

pdf("hcl.pdf", width=40, height=15)
plot(hcl)
dev.off()


hcl2 <- hclust(dsi_m)
plot(hcl2)

pdf("hcl2.pdf", width=40, height=15)
plot(hcl2)
dev.off()

```

We now are able to cluster both concepts and DSI's. For simplicity we can cluster our DSI's into 3 buckets, with 1 bucket being a catch all. We summarise which would be in each bucket, and the bucket totals below. 

From the looks of things 3 clusters seems about right for DSI's. As for terms we start at roughly 10, which is very clumped together, but as we widen out to roughly 20 clusters our first few seem to be nicely distributed, with few clusters with only 1 term. 

30 clusters for terms seems to be to many. 



```{r hclust2}

nclust <- 10


t0 <- table(d$word, cutree(hcl, 3))
t <- table(d$word, cutree(hcl, nclust))
t2 <- table(d$word, cutree(hcl, nclust + 10))
t3 <- table(d$word, cutree(hcl, nclust + 20))

## DSI clusters sums

cutree(hcl2, 3)
rowSums(table(cutree(hcl2, 3),colnames(c_m)))

cutree(hcl2, 4)
rowSums(table(cutree(hcl2, 4),colnames(c_m)))

## Keyword concept clusters 

colSums(t, 1:nclust)

colSums(t2, 1:nclust+10)

colSums(t3, 1:nclust+20)

### DSI clusters
write.csv(table(cutree(hcl2, 3),colnames(c_m)),
          paste("H_clustDSI_firstpass", ".csv", sep = ""))


write.csv(t2,
          paste("H_TERMS_firstpass", ".csv", sep = ""))


```








