---
title: "Clust_01"
author: "Ricardo Herena"
date: "8/5/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
setwd("~/Documents/Text Analysis Pred 453/P454_TextCluster")
library("tm")
library("SnowballC")
library("wordcloud")
library("RColorBrewer")
library(cluster)
```


```{r read_data}

c_m = read.csv("Conc_Matrix.csv", sep=",", row.names=1)
c_m <- as.matrix(c_m)
dsi_m <- t(c_m)
d_m <- dist(c_m, method="euclidean")
dsi_m <- dist(dsi_m, method="euclidean")

```

Below are some word clouds. We can use these to understand our matrix from a high level. We can also compute tf-idf for word clouds. 

```{r tf-idf-wordclouds}

#tf-idf totals for plotting
v <- sort(rowSums(c_m),decreasing=TRUE)
d <- data.frame(word = names(v),freq=v)

set.seed(1234)
wordcloud(words = d$word, freq = d$freq, min.freq = 1,
          max.words=200, random.order=FALSE, rot.per=0.35, 
          colors=brewer.pal(8, "Dark2"))


```

Hierarchical Clustering

We can see various clusters emerging from our Hclust. We write this to a PDF. A we can see there are many clusters that stem from the top. Our initial guess is something like 10-20 clusters, but very messy ones for the word concepts, and around 6 DSI clusters as identified by prior cohorts.

```{r hclust1}

hcl <- hclust(d_m)
plot(hcl)

pdf("hcl.pdf", width=40, height=15)
plot(hcl)
dev.off()


hcl2 <- hclust(dsi_m)
plot(hcl2)

pdf("hcl2.pdf", width=40, height=15)
plot(hcl2)
dev.off()

```

We make 3 table files with potential 1st pass clusters. We start with 10, 20, and 30 clusters. These represent clusters of words, rather than DSI's which we will cluster below. 
We also put these into four main clusters. All of these are summarized below. 

```{r hclust2}

nclust <- 10

t <- table(d$word, cutree(hcl, nclust))
t2 <- table(d$word, cutree(hcl, nclust + 10))
t3 <- table(d$word, cutree(hcl, nclust + 20))

t4 <- table(cutree(hcl2, 10),colnames(c_m))

rowSums(t4)

### DSI clusters
write.csv(t4, paste("H_clustDSI_firstpass", ".csv", sep = ""))

write.csv(t3, paste("H_clust_firstpass",nclust+20, ".csv", sep = ""))

```








